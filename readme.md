# 基于深度学习的校园学生轨迹追踪系统

## 项目简介
本项目是一个基于深度学习的校园学生轨迹追踪系统，旨在通过后端的深度学习模型和前端的可视化界面，实现对学生轨迹的追踪与分析。后端采用 Python 技术栈，结合 PyTorch 和 OpenCV 实现深度学习模型的训练与推理；前端采用 Vue.js 技术栈，提供用户友好的交互界面。

---

## 核心技术栈

本项目采用了当前主流且高效的技术栈，确保了系统的性能、可扩展性和可维护性：

* **深度学习框架**：
    * **PyTorch**：作为主要的深度学习框架，用于模型训练、推理及特征提取。
* **目标检测**：
    * **YOLOv8**：用于视频流中的行人检测，提供高精度和实时性。
* **多目标跟踪 (MOT)**：
    * **ByteTrack / BoT-SORT**：用于单摄像头下对检测到的行人进行持续跟踪，生成连续运动轨迹。
* **行人重识别 (Re-ID)**：
    * **MGN (Multi-Granularity Network)**：用于提取行人深层特征，实现跨摄像头的身份匹配，解决目标遮挡和外观变化问题。
* **后端开发**：
    * **Python (Flask)**：轻量级Web框架，提供RESTful API接口，处理核心业务逻辑和数据交互。
* **前端开发**：
    * **Vue.js**：渐进式JavaScript框架，构建用户交互界面。
    * **Element UI**：基于Vue.js的组件库，提供美观、易用的UI组件。
    * **百度地图API**：用于地图展示、摄像头位置标注和学生轨迹可视化。
* **数据库**：
    * **MySQL**：关系型数据库，存储学生信息、摄像头配置、视频记录及学生轨迹数据。
* **开发环境**：
    * **PyCharm**：集成开发环境 (IDE)。
---

## 功能模块设计

系统采用模块化设计思想，划分为以下九大核心模块：

1.  **查询过滤模块**：
    * **功能**：支持用户依据时间范围、学生学号、学生姓名、性别、年级、专业甚至携带物（如背包、雨伞、自行车）和衣物颜色等多种组合条件，灵活高效地查询学生轨迹信息。
2.  **时空约束模块**：
    * **功能**：集成校园地图信息与路径规划逻辑，对初步生成的学生轨迹数据进行合理性校验。过滤掉因误检测或环境干扰（如遮挡、光照变化）导致的不合理轨迹，提升轨迹数据的准确性与鲁棒性。
    * **未来优化方向**：可融入学生运动方向判断，提高过滤精度。
3.  **视频处理模块**：
    * **功能**：负责接入监控视频数据（当前为离线视频），执行YOLOv8行人检测，并从中提取行人图像帧。
    * **未来优化方向**：实现对实时视频流的分析和处理。
4.  **特征提取与匹配模块**：
    * **功能**：利用MGN行人重识别模型从行人图像中提取独特的深层特征向量。通过特征匹配算法，实现跨摄像头视角的学生身份关联，解决跨区域追踪问题。
5.  **轨迹管理模块**：
    * **功能**：负责存储、管理和维护学生历史轨迹数据，包括轨迹点的序列、经过的摄像头序列、总距离和平均速度等信息。
6.  **学生信息管理模块**：
    * **功能**：集中管理学生的基本档案信息，包括学号、姓名、性别、年级、专业、联系方式等，为轨迹数据关联到具体学生身份提供基础数据支持。
7.  **监控信息管理模块**：
    * **功能**：存储和管理校园内所有摄像头的配置信息，包括摄像头ID、地理坐标、IP地址、端口、协议及认证信息等，确保视频流的正确获取。
8.  **用户信息管理模块**：
    * **功能**：负责系统用户的注册、登录、权限分配和管理，确保系统操作的安全性和数据访问的合规性。
9.  **个人信息模块**：
    * **功能**：允许已登录用户查看和修改自己的个人账户信息，并支持权限分级，确保敏感数据仅对授权管理员开放。

---

## 环境配置

### 后端环境
1. **安装 Python**: 请确保安装 Python 3.9 或以上版本。
2. **安装依赖**:
   ```bash
   pip install -r backend/requirements.txt
   ```
3. **配置 CUDA**: 如果使用 GPU，请确保安装正确版本的 CUDA 和 cuDNN。

### 前端环境
1. **安装 Node.js**: 请确保安装 Node.js 18 或以上版本。
2. **安装依赖**:
   ```bash
   cd frontend
   npm install
   ```
   或使用 yarn:
   ```bash
   yarn install
   ```

---

## 使用说明

### 后端启动
1. **运行后端服务**:
   ```bash
   python backend/app.py
   ```
2. 后端服务默认运行在 `http://127.0.0.1:5000`。

### 前端启动
1. **运行前端服务**:
   ```bash
   cd frontend
   npm run serve
   ```
   或使用 yarn:
   ```bash
   yarn serve
   ```
2. 前端服务默认运行在 `http://localhost:8081`。

---

### 数据库配置
1. **创建数据库**: 使用 SQL 创建所需的数据库表。
2. **配置连接**: 在 `backend/app.py` 中设置数据库连接字符串。

---

### 阿里云配置
1. **OSS 配置**: 在阿里云 OSS 上创建存储桶，并配置访问密钥。
2. **视频上传**: 将监控视频上传到 OSS，并在数据库中记录视频路径。
3. **注意**: 原系统测试的视频文件已上传至阿里云 OSS，现代码逻辑也是基于 OSS 获取监控视频数据。

---

### 百度地图API配置
1. **申请 API Key**: 在百度地图开放平台申请 API Key。
2. **配置前端**: 在 `frontend/index.html` 中设置百度地图 API Key。

---

### 数据准备与测试

1.  **导入摄像头配置数据**：在 `cameras` 表中添加模拟的摄像头数据，包括其ID、坐标、名称等。
2.  **准备离线视频**：将模拟的监控视频文件放置在项目指定的路径，并在 `camera_videos` 表中注册这些视频的路径信息。
3.  **注册测试用户**：在 `users` 表中添加一个管理员账户用于登录系统。
4.  **登录系统**：使用注册的管理员账户登录前端界面，即可访问系统的各项功能，包括查看摄像头、查询学生轨迹、管理学生信息等。
